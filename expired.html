<!DOCTYPE html>
<html lang="id">
<head>
  <meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta charset="UTF-8">
  <title>Detail Expired Item</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="container">

<h2>Detail Expired Item</h2>

<!-- FORM -->
<div class="input-box">
  <input id="itemName" placeholder="Nama Item">
</div>

<div class="input-box">
  <select id="duration">
    <option value="">Pilih Masa Expired</option>
    <option value="1">1 Hari</option>
    <option value="2">2 Hari</option>
    <option value="4">4 Hari</option>
    <option value="7">7 Hari</option>
    <option value="14">14 Hari</option>
    <option value="30">1 Bulan</option>
    <option value="60">2 Bulan</option>
    <option value="90">3 Bulan</option>
    <option value="180">6 Bulan</option>
  </select>
</div>

<button class="primary" onclick="saveOrder()">Simpan</button>

<hr>

<div class="print-all">
  <span onclick="printAll()">ğŸ–¨ï¸ Print Semua</span>
</div>

<h3>Daftar Item</h3>

<div id="print-area">
  <div id="list"></div>
</div>
<a href="index.html">â¬… Kembali</a>

<script>
  const params = new URLSearchParams(location.search);
  const id = Number(params.get('id'));

  let expired = JSON.parse(localStorage.getItem('expired')) || [];
  let data = expired.find(e => e.id === id);
  if (!data.orders) data.orders = [];

  function getToday() {
    const d = new Date();
    return d.toISOString().split('T')[0]; // YYYY-MM-DD
  }

  function calculateExpired(days, openedDate) {
    const d = new Date(openedDate);
    d.setDate(d.getDate() + days);
    return d.toISOString().split('T')[0];
  }

  function saveOrder() {
    const name = itemName.value.trim();
    const days = Number(duration.value);

    if (!name || !days) return alert('Lengkapi data');

    data.orders.push({
      id: Date.now(),
      name : itemName,
      days : days,
      opened: getToday()
    });

    localStorage.setItem('expired', JSON.stringify(expired));
    itemName.value = '';
    duration.value = '';
    render();
  }

  function render() {
  list.innerHTML = '';
  data.orders.forEach(o => {
    const div = document.createElement('div');
    div.className = 'order-card';
    div.innerHTML = `
      <div class="order-title">${o.name}</div>
      <div class="order-meta">
        Opened: ${o.opened}
        Masa exp: ${o.days} hari<br>
        Expired: ${calculateExpired(o.days,o.opened)}
      </div>

      <div class="order-actions">
        <span class="action-btn print" onclick="printOne('${o.name}',${o.days},'${o.opened}')">ğŸ–¨ï¸</span>
        <span class="action-btn edit" onclick="editOrder('${o.name}',${o.days})">âœï¸</span>
        <span class="action-btn delete" onclick="deleteOrder(${o.id})">ğŸ—‘ï¸</span>
      </div>
    `;
    list.appendChild(div);
  });
}

function printAll() {
  window.print();
}

  function editOrder(orderId) {
    const o = data.orders.find(x => x.id === orderId);
    const newName = prompt('Edit nama item', o.name);
    if (!newName) return;
    o.name = newName;
    localStorage.setItem('expired', JSON.stringify(expired));
    render();
  }

  function deleteOrder(orderId) {
    if (!confirm('Hapus item ini?')) return;
    data.orders = data.orders.filter(o => o.id !== orderId);
    localStorage.setItem('expired', JSON.stringify(expired));
    render();
  }

  function printOne(name, days, opened) {
    alert(`Tomoro Coffee daydot\n${name}\nOpened : ${opened}\nMasa exp : ${days} hari\nExpired: ${calculateExpired(days,opened)}`);
  }

  function printAll() {
    let text = 'PRINT SEMUA\\n\\n';
    data.orders.forEach(o => {
      text += `${o.name} 
      Opened : ${o.opened} 
      Masa exp : ${o.days} hari  
      Expired : ${calculateExpired(o.days, o.opened)}\\n`;
    });
    alert(text);
  }

  render();
</script>

</body>
</html>
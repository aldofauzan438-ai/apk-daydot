<!DOCTYPE html>
<html lang="id">
<head>
  <meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta charset="UTF-8">
  <title>Detail Expired Item</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="container">

<h2>Detail Expired Item</h2>

<!-- FORM -->
<div class="input-box">
  <input id="itemName" placeholder="Nama Item">
</div>

<div class="input-box">
  <select id="duration">
    <option value="">Pilih Masa Expired</option>
    <option value="1">1 Hari</option>
    <option value="2">2 Hari</option>
    <option value="4">4 Hari</option>
    <option value="7">7 Hari</option>
    <option value="14">14 Hari</option>
    <option value="30">1 Bulan</option>
    <option value="60">2 Bulan</option>
    <option value="90">3 Bulan</option>
    <option value="180">6 Bulan</option>
  </select>
</div>

<button class="primary" onclick="saveOrder()">Simpan</button>

<hr>

<div class="print-all">
  <span onclick="printAll()">üñ®Ô∏è Print Semua</span>
</div>

<h3>Daftar Item</h3>

<div id="print-area">
  <div id="list"></div>
</div>
<a href="index.html">‚¨Ö Kembali</a>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const list = document.getElementById('list');
  const itemName = document.getElementById('itemName');
  const duration = document.getElementById('duration');

  let data = JSON.parse(localStorage.getItem('expiredData')) || { orders: [] };

  function formatDateShort(dateStr) {
    const [y,m,d] = dateStr.split('-');
    return `${d}-${m}-${y.slice(2)}`;
  }

  function getLiveTime() {
    return new Date().toTimeString().slice(0,5);
  }

  function calculateExpired(days, openedDate) {
    const d = new Date(openedDate);
    d.setDate(d.getDate() + days);
    return d.toISOString().split('T')[0];
  }

  window.saveOrder = function () {
    if (!itemName.value || !duration.value) return alert('Lengkapi data');

    data.orders.push({
      id: Date.now(),
      name: itemName.value,
      days: Number(duration.value),
      openedDate: new Date().toISOString().split('T')[0]
    });

    localStorage.setItem('expiredData', JSON.stringify(data));
    itemName.value = '';
    duration.value = '';
    render();
  };

  function render() {
    list.innerHTML = '';

    data.orders.forEach(o => {
      const exp = calculateExpired(o.days, o.openedDate);
      list.innerHTML += `
        <div class="order-card">
          <b>Nama Item : ${o.name}</b><br>
          Opened : ${formatDateShort(o.openedDate)}<br>
          Time : <span class="live-time">${getLiveTime()}</span><br>
          Masa exp : ${o.days} hari<br>
          Expired : ${formatDateShort(exp)}
        </div>
      `;
    });
  }

  setInterval(() => {
    document.querySelectorAll('.live-time')
      .forEach(el => el.textContent = getLiveTime());
  }, 60000);

  render();
});

</script>




</body>
</html>
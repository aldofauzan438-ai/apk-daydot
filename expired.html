<!DOCTYPE html>
<html lang="id">
<head>
  <meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta charset="UTF-8">
  <title>Detail Expired Item</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="container">

<h2>Detail Expired Item</h2>

<!-- FORM -->
<div class="input-box">
  <input id="itemName" placeholder="Nama Item">
</div>

<div class="input-box">
  <select id="duration">
    <option value="">Pilih Masa Expired</option>
    <option value="1">1 Hari</option>
    <option value="2">2 Hari</option>
    <option value="4">4 Hari</option>
    <option value="7">7 Hari</option>
    <option value="14">14 Hari</option>
    <option value="30">1 Bulan</option>
    <option value="60">2 Bulan</option>
    <option value="90">3 Bulan</option>
    <option value="180">6 Bulan</option>
  </select>
</div>

<button class="primary" onclick="saveOrder()">Simpan</button>

<hr>

<div class="print-all">
  <span onclick="printAll()">ğŸ–¨ï¸ Print Semua</span>
</div>

<h3>Daftar Item</h3>

<div id="print-area">
  <div id="list"></div>
</div>
<a href="index.html">â¬… Kembali</a>

<script>
  const params = new URLSearchParams(location.search);
  const id = Number(params.get('id'));

  let editingId = null;
  let expired = JSON.parse(localStorage.getItem('expired')) || [];
  let data = expired.find(e => e.id === id);

  if (!data) {
    data = { id, orders: [] };
    expired.push(data);
  }

  const list = document.getElementById('list');
  const itemName = document.getElementById('itemName');
  const duration = document.getElementById('duration');


  function formatDateShort(dateStr) {
  if (!dateStr) return '';
  const [y, m, d] = dateStr.split('-');
  return `${d}-${m}-${y.slice(2)}`; // 03-01-26
}

  function getLiveTime() {
  const d = new Date();
  return d.toTimeString().slice(0,5); // HH:MM
}

  function getNow() {
  const d = new Date();
  return {
    date: d.toISOString().split('T')[0], // YYYY-MM-DD
    time: d.toTimeString().slice(0,5)    // HH:MM
  };
}

  function calculateExpired(days, openedDate) {
    const d = new Date(openedDate);
    d.setDate(d.getDate() + days);

    return {
      date: d.toISOString().split('T')[0],
    };
  }

  function saveOrder() {
    const name = itemName.value.trim();
    const days = Number(duration.value);
    const now = getNow();

    if (!name || !days) {
      alert('Lengkapi data');
      return;
    }

    data.orders.push({
      id: Date.now(),
      name: name,       
      days: days,
      openedDate: now.date,
      openedTime: now.time
    });

    localStorage.setItem('expired', JSON.stringify(expired));
    itemName.value = '';
    duration.value = '';
    render();
  }

  function formatDate(dateStr) {
  if (!dateStr) return '';
  const [y, m, d] = dateStr.split('-');
  return `${d}-${m}-${y}`;
}

  function render() {
  list.innerHTML = '';

  data.orders.forEach(o => {
    const openedDate = o.openedDate;
    const exp = calculateExpired(o.days, openedDate);

    const div = document.createElement('div');
    div.className = 'order-card';
    div.innerHTML = `
      <div class="order-title">Nama Item : ${o.name}</div>
      <div class="order-meta">
        Opened   : ${formatDateShort(openedDate)}<br>
        Time     : <span class="live-time">${getLiveTime()}</span><br>
        Masa exp : ${o.days} hari<br>
        Expired  : ${formatDateShort(exp.date)}
      </div>

      <div class="order-actions">
        <button class="action-btn print"
          onclick="printOne('${o.name}', ${o.days}, '${openedDate}')">ğŸ–¨ï¸</button>
        <button class="action-btn edit" onclick="editOrder(${o.id})">âœï¸</button>
        <button class="action-btn delete" onclick="deleteOrder(${o.id})">ğŸ—‘ï¸</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function editOrder(orderId) {
  const o = data.orders.find(x => x.id === orderId);
  if (!o) return;

  // Edit nama
  const newName = prompt('Edit nama item', o.name);
  if (newName === null) return;

  // "Dropdown" versi alert
  const options = [
    { label: '1 Hari', value: 1 },
    { label: '2 Hari', value: 2 },
    { label: '4 Hari', value: 4 },
    { label: '7 Hari', value: 7 },
    { label: '14 Hari', value: 14 },
    { label: '30 Hari', value: 30 },
    { label: '60 Hari', value: 60 },
    { label: '90 Hari', value: 90 },
    { label: '180 Hari', value: 180 }
  ];

  let message = 'Pilih masa expired:\n';
  options.forEach((o, i) => {
    message += `${i + 1}. ${o.label}\n`;
  });

  const choice = prompt(message);
  if (choice === null) return;

  const selected = options[Number(choice) - 1];
  if (!selected) {
    alert('Pilihan tidak valid');
    return;
  }

  o.name = newName.trim();
  o.days = selected.value;

  localStorage.setItem('expired', JSON.stringify(expired));
  render();
}


  function deleteOrder(orderId) {
    if (!confirm('Hapus item ini?')) return;
    data.orders = data.orders.filter(o => o.id !== orderId);
    localStorage.setItem('expired', JSON.stringify(expired));
    render();
  }

 function printOne(name, days, openedDate) {
  const exp = calculateExpired(days, openedDate);
  const liveTime = getLiveTime(); // â¬…ï¸ JAM SAAT PRINT

  alert(
`Tomoro Coffee
Nama Item : ${name}
Opened    : ${formatDateShort(openedDate)}
Time      : ${liveTime}
Masa exp  : ${days} hari
Expired   : ${formatDateShort(exp.date)}`
  );
}

 function printAll() {
  let text = 'PRINT SEMUA\n\n';
  const nowTime = getLiveTime();

  data.orders.forEach(o => {
    const exp = calculateExpired(o.days, o.openedDate);
    text += `${o.name}
Opened    : ${formatDateShort(o.openedDate)}
Time      : ${nowTime}
Masa exp  : ${o.days} hari
Expired   : ${formatDateShort(exp.date)}\n\n`;
  });

  alert(text);
}

  render();
  // update jam setiap 1 menit (hemat baterai)
setInterval(() => {
  document.querySelectorAll('.live-time').forEach(el => {
    el.textContent = getLiveTime();
  });
}, 60000);
</script>



</body>
</html>